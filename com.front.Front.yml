app-id: com.front.Front
runtime: org.freedesktop.Platform
runtime-version: '24.08'
sdk: org.freedesktop.Sdk
base: org.electronjs.Electron2.BaseApp
base-version: '24.08'
command: com.front.Front
tags:
  - proprietary
separate-locales: false

finish-args:
  - --socket=x11
  - --socket=pulseaudio
  - --device=dri
  - --filesystem=xdg-download
  - --share=network
  - --talk-name=com.canonical.Unity
  - --talk-name=org.freedesktop.portal.Desktop
  - --talk-name=org.freedesktop.Notifications
  - --env=XCURSOR_PATH=/run/host/user-share/icons:/run/host/share/icons
  - --env=ELECTRON_TRASH=gio

modules:
  - name: front
    buildsystem: simple
    build-commands:
      - chmod +x front.AppImage
      - ./front.AppImage --appimage-extract

      - mkdir /app/front
      - mv squashfs-root/* /app/front
      - find /app/front -type d -exec chmod 755 {} +
      - find /app/front -type f -exec chmod 644 {} +

      - mv /app/front/usr/lib/* /app/lib
      - rm -rf /app/front/usr
      - chmod +x /app/front/front /app/front/chrome-sandbox /app/front/chrome_crashpad_handler
      - patch-desktop-filename /app/front/resources/app.asar

      - |
        for s in 16 32 64 128 256 512; do
          install -Dm644 icon${s}.png /app/share/icons/hicolor/${s}x${s}/apps/${FLATPAK_ID}.png
        done
      - install -Dm644 icon.svg /app/share/icons/hicolor/scalable/apps/${FLATPAK_ID}.svg
      - install -Dm755 front.sh /app/bin/${FLATPAK_ID}
      - install -Dm644 ${FLATPAK_ID}.desktop -t /app/share/applications
      - install -Dm644 ${FLATPAK_ID}.metainfo.xml -t /app/share/metainfo

    sources:
      - type: file
        dest-filename: front.AppImage
        url: https://dl.frontapp.com/desktop/builds/3.65.1/Front-3.65.1-x86_64.AppImage
        sha512: 436bc0ec83b0abde6767fc2fa1f4badbfc99263083f0a25a1bbf65b34de8b9bea6ece7a16227678823786182b35d41bee5d0713f73f72101a10e7dc7e4b5ce1d
        x-checker-data:
          type: electron-updater
          url: https://dl.frontapp.com/desktop/updates/latest/linux-x64-AppImage/latest-linux.yml

      - type: file
        path: front.sh

      - type: file
        path: com.front.Front.desktop

      - type: file
        path: com.front.Front.metainfo.xml

      - type: file
        path: icons/icon.svg

      - type: file
        path: icons/icon16.png

      - type: file
        path: icons/icon32.png

      - type: file
        path: icons/icon64.png

      - type: file
        path: icons/icon128.png

      - type: file
        path: icons/icon256.png

      - type: file
        path: icons/icon512.png
